machine:
    environment:
        PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"
    node:
        version: 6

dependencies:
    pre:
        # ensures pre-commit dependencies are properly installed;
        # see https://github.com/pre-commit/pre-commit/issues/280
        - pip install --upgrade pip
    override:
        - pip install pre-commit
        - yarn global add bower ember-cli
        - yarn
        - bower install
        - bower --version
        # create pre-commit directory so it can be cached;
        # see https://circleci.com/docs/how-cache-works/
        - mkdir -p ~/.pre-commit
    post:
        - pre-commit install
    cache_directories:
        - ~/.pre-commit
        - ~/.cache/yarn

test:
    override:
        - pre-commit run --all-files
        - npm test
    post:
        # Collect code coverage artifacts; see https://github.com/kategengler/ember-cli-code-coverage
        # Depends on environment variable `COVERAGE` being set in CI
        # You can also run locally: `COVERAGE=true ember test`
        - mkdir -p $CIRCLE_ARTIFACTS/coverage
        - if [ "$COVERAGE" = true ]; then cp -r coverage/* $CIRCLE_ARTIFACTS/coverage; fi
        # Collect xunit artifact; see https://circleci.com/docs/test-metadata#js
        # Depends on `testem.json` having:
        # ```js
        # "reporter": "xunit",
        # "report_file": "tests/reports/QUnit.xml",
        # ```
        - mkdir -p $CIRCLE_TEST_REPORTS/QUnit
        - cp tests/reports/* $CIRCLE_TEST_REPORTS/QUnit/
